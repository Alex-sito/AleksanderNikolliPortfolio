
<form
  class="pricing-form"
  [formGroup]="form"
  (ngSubmit)="calculate()"
>

  <!-- =====================
       CAMPI DINAMICI
  ====================== -->
  <ng-container *ngFor="let key of optionKeys; trackBy: trackByKey">

    <div class="form-group">

      <!-- LABEL + INFO -->
      <div class="label-row">
        <label [attr.for]="key">
          {{ pricingInfo[key].title }}
        </label>

        <button
          type="button"
          class="info-btn"
          (click)="toggleInfo(key)"
        >
          ‚ìò {{ detailsLabel }}
        </button>
      </div>

      <!-- INPUT -->
      <ng-container [ngSwitch]="key">

        <!-- NUMERO PAGINE -->
        <input
          *ngSwitchCase="'pages'"
          [id]="key"
          type="number"
          min="1"
          formControlName="pages"
        />

        <!-- NUMERO LINGUE -->
        <input
          *ngSwitchCase="'languages'"
          [id]="key"
          type="number"
          min="1"
          formControlName="languages"
        />

        <!-- SELECT GENERICA -->
        <select
          *ngSwitchDefault
          [id]="key"
          [formControlName]="key"
        >
          <option
            *ngFor="let opt of selectOptions[key]"
            [value]="opt.value"
          >
            {{ opt.label }}
          </option>
        </select>

      </ng-container>

      <!-- DETTAGLI -->
      <div
        class="info-box"
        *ngIf="openedInfo === key"
      >
        <p>{{ pricingInfo[key].description }}</p>

        <ul *ngIf="pricingInfo[key].notes?.length">
          <li *ngFor="let note of pricingInfo[key].notes">
            {{ note }}
          </li>
        </ul>
      </div>

    </div>

  </ng-container>

  <!-- SUBMIT -->
  <button
    type="submit"
    class="submit-btn"
    [disabled]="loading || form.invalid"
  >
    {{ loading ? calculatingLabel : calculateLabel }}
  </button>

</form>

<!-- =====================
     PREVIEW LIVE
====================== -->
<section
  class="live-preview"
  *ngIf="previewTotal !== null"
>
  <strong>{{ estimateLabel }}</strong>
  ‚Ç¨{{ previewTotal }}
</section>

<!-- =====================
     RISULTATO
====================== -->
<section
  *ngIf="result"
  class="pricing-result"
>

  <!-- SCONTO -->
  <div
    *ngIf="result.discountRate > 0"
    class="discount-banner"
  >
    üî• -{{ result.discountRate * 100 }}%
    <span>
      {{ validUntilLabel }}
      {{ result.validUntil | date:'dd/MM/yyyy' }}
    </span>
    <strong>‚è≥ {{ countdownText }}</strong>
  </div>

  <h2>
    {{ discountedTotalLabel }} ‚Ç¨{{ result.discountedTotal }}
  </h2>

  <p
    *ngIf="result.discountRate > 0"
    class="old-price"
  >
    {{ originalPriceLabel }} ‚Ç¨{{ result.total }}
  </p>

  <!-- RIEPILOGO -->
  <div class="summary-box">
    <h3>{{ summaryLabel }}</h3>

    <ul class="summary-list">
      <li *ngFor="let key of optionKeys; trackBy: trackByKey">
        <span class="label">
          {{ pricingInfo[key].title }}
        </span>
        <span class="value">
          ‚Ç¨{{ result.breakdown[key] || 0 }}
        </span>
      </li>
    </ul>
  </div>

  <!-- CTA -->
  <button
    type="button"
    class="whatsapp-btn discount"
    (click)="openWhatsapp()"
  >
    üí¨ {{ whatsappLabel }}
  </button>

</section>

